

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>3HFood API</title>

    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" media="screen" rel="stylesheet">
    <link href="slate/css/print.css" media="print" rel="stylesheet">
    <link href="slate/css/screen.css" media="screen" rel="stylesheet">
    <script src="slate/js/lib/jquery.min.js"></script>
    <script src="slate/js/lib/jquery.highlight.js"></script>
    <script src="slate/js/lib/energize.js"></script>
    <script src="slate/js/lib/imagesloaded.min.js"></script>
    <script src="slate/js/lib/lunr.min.js"></script>
    <script src="slate/js/app/lang.js"></script>
    <script src="slate/js/app/toc.js"></script>
    
    <script src="slate/js/app/search.js"></script>
    
    
    <script src="slate/js/app/copy.js"></script>
    
    <script type="text/javascript">
      function adjustLanguageSelectorWidth() {
        const elem = $('.dark-box > .lang-selector');
        elem.width(elem.parent().width());
      }
      $(function() {
        loadToc($('#toc'), '.toc-link', '.toc-list-h2, .toc-list-h3, .toc-list-h4, .toc-list-h5, .toc-list-h6', 10);
        setupLanguages($('body').data('languages'));
        $('.content').imagesLoaded( function() {
          recacheHeights();
          refreshToc();
        });
        $(window).resize(function() {
          adjustLanguageSelectorWidth();
        });
        adjustLanguageSelectorWidth();
      });
      window.onpopstate = function() {
        activateLanguage(getLanguageFromQueryString());
      };
    </script>
    <!-- slate; content for the head element from source/includes/head.ejs -->
<meta name="theme-color" content="#F3F7F9">

  </head>

  <body data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="slate/img/navbar.png" alt="Navigation">
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="slate/img/logo.png" alt="Logo" class="logo">
      
        <div class="lang-selector">
          
            
              <a href="#" data-language-name="javascript">javascript</a>
            
          
        </div>
      
      
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      

      
        
      
        
      

      <div id="toc" class="toc-list-h1">
	  	<ul class="toc-list-h1">
        
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
            
          </li>
        
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
            
          </li>
        
          <li>
            <a href="#common---back-office" class="toc-h1 toc-link" data-title="COMMON - Back Office">COMMON - Back Office</a>
            
              <ul class="toc-list-h2">
                
                  <li>
                    <a href="#check-user-exists-%26-can-access-bo" class="toc-h2 toc-link" data-title="">Check user exists &amp; can access BO</a>
                    
                  </li>
                
                  <li>
                    <a href="#get-user-details" class="toc-h2 toc-link" data-title="">Get user details</a>
                    
                  </li>
                
                  <li>
                    <a href="#register-client" class="toc-h2 toc-link" data-title="">Register client</a>
                    
                  </li>
                
                  <li>
                    <a href="#register-privilegied-user" class="toc-h2 toc-link" data-title="">Register Privilegied User</a>
                    
                  </li>
                
              </ul>
            
          </li>
        
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
            
          </li>
        
		</ul>
      </div>
      
        <ul class="toc-footer">
          
            <li><a href='https://github.com/slatedocs/slate'>Documentation Powered by Slate</a></li>
          
        </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>
<p>L’API 3Hfood est une api unique pour tous les endpoints de toutes les applications 3HFood.</p>
<p>Le tout est hébergé sur des cloud function, les fonctions sont alors à appeler par le biais du package firebase dans l’application</p>
<h1 id="authentication">Authentication</h1>
<p>Toutes les routes (sauf login) ont besoin d’une authentification pour foncionner. Le package firebase se charge tout seul du renew de token, et de passer le token dans la requête.</p>
<h1 id="common---back-office">COMMON - Back Office</h1>
<h2 id="check-user-exists-%26-can-access-bo">Check user exists &amp; can access BO</h2>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> cloudFunction <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">functions</span><span class="token punctuation">(</span><span class="token string">'europe-west3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">httpsCallable</span><span class="token punctuation">(</span><span class="token string">'common-userExistsForBackOffice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  email<span class="token operator">:</span> <span class="token string">"florent.huran@outlook.fr"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">cloudFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"continueLogin"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token property">"shouldRenewPassword"</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This endpoint checks if user exists and can access the BO.</p>
<h3 id="http-request">HTTP Request</h3>
<p><code>GET common-userExistsForBackOffice</code></p>
<h3 id="query-parameters">Query Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Email</td>
<td>false</td>
<td>Email the user entered on the field</td>
</tr>
</tbody>
</table>
<h2 id="get-user-details">Get user details</h2>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> cloudFunction <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">functions</span><span class="token punctuation">(</span><span class="token string">'europe-west3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">httpsCallable</span><span class="token punctuation">(</span><span class="token string">'common-getUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">cloudFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"user"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"WHOLESALER"</span><span class="token punctuation">,</span>
            <span class="token property">"first_name"</span><span class="token operator">:</span> <span class="token string">"Florent"</span><span class="token punctuation">,</span>
            <span class="token property">"last_name"</span><span class="token operator">:</span> <span class="token string">"Huran"</span><span class="token punctuation">,</span>
            <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"florent.huran@outlook.fr"</span><span class="token punctuation">,</span>
            <span class="token property">"must_renew_password"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"phone"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"address"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"zipcode"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"city"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"carbon_footprint"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"iban"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"bic"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"stripe_customer_id"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"stripe_mandate_id"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"current_cart_uuid"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This endpoint checks user details if authenticated in firebase.</p>
<h3 id="http-request-1">HTTP Request</h3>
<p><code>GET common-getUser</code></p>
<h3 id="query-parameters-1">Query Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="register-client">Register client</h2>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> cloudFunction <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">functions</span><span class="token punctuation">(</span><span class="token string">'europe-west3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">httpsCallable</span><span class="token punctuation">(</span><span class="token string">'common-createClient'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
		firstName<span class="token operator">:</span> <span class="token string">"Kamil"</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">"Hammouche"</span><span class="token punctuation">,</span>
    phone<span class="token operator">:</span> <span class="token string">"0612345678"</span><span class="token punctuation">,</span>
    address<span class="token operator">:</span> <span class="token string">"25 rue Nationale"</span><span class="token punctuation">,</span>
    zipcode<span class="token operator">:</span> <span class="token string">"59000"</span><span class="token punctuation">,</span>
    city<span class="token operator">:</span> <span class="token string">"Lille"</span><span class="token punctuation">,</span>
    iban<span class="token operator">:</span> <span class="token string">"FR12345678901234"</span><span class="token punctuation">,</span>
    bic<span class="token operator">:</span> <span class="token string">"CMCIFR2A"</span><span class="token punctuation">,</span>
    stripeCustomerId<span class="token operator">:</span> <span class="token string">"cst_324TYH5Y"</span><span class="token punctuation">,</span>
    stripeMandateId<span class="token operator">:</span> <span class="token string">"mdt_12345678T"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">cloudFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This endpoint takes all the parameters from registration and create the user object in database</p>
<h3 id="http-request-2">HTTP Request</h3>
<p><code>GET common-createClient</code></p>
<h3 id="query-parameters-2">Query Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>firstName</td>
<td>String</td>
<td>First name of user</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>Last name of user</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>Phone of user</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>Address of user</td>
</tr>
<tr>
<td>zipcode</td>
<td>String</td>
<td>Zipcode of user - 5 chars max</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>City of user</td>
</tr>
<tr>
<td>iban</td>
<td>String</td>
<td>IBAN used for stripe registration</td>
</tr>
<tr>
<td>bic</td>
<td>String</td>
<td>BIC used for stripe registration</td>
</tr>
<tr>
<td>stripeCustomerID</td>
<td>String</td>
<td>ID given by stripe at user registration</td>
</tr>
<tr>
<td>stripeMandateId</td>
<td>String</td>
<td>Mandate ID given when SEPA debit has been accepted</td>
</tr>
</tbody>
</table>
<h2 id="register-privilegied-user">Register Privilegied User</h2>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">let</span> cloudFunction <span class="token operator">=</span> firebase<span class="token punctuation">.</span><span class="token function">app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">functions</span><span class="token punctuation">(</span><span class="token string">'europe-west3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">httpsCallable</span><span class="token punctuation">(</span><span class="token string">'common-createElevatedUser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">"SUPERMARKET"</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">"Kamil"</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">"Hammouche"</span><span class="token punctuation">,</span>
    phone<span class="token operator">:</span> <span class="token string">"0612345678"</span><span class="token punctuation">,</span>
    address<span class="token operator">:</span> <span class="token string">"25 rue Nationale"</span><span class="token punctuation">,</span>
    zipcode<span class="token operator">:</span> <span class="token string">"59000"</span><span class="token punctuation">,</span>
    city<span class="token operator">:</span> <span class="token string">"Lille"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">cloudFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This endpoint takes all the parameters from registration and create the user object in database</p>
<h3 id="http-request-3">HTTP Request</h3>
<p><code>GET common-createClient</code></p>
<h3 id="query-parameters-3">Query Parameters</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>firstName</td>
<td>String</td>
<td>First name of user</td>
</tr>
<tr>
<td>lastName</td>
<td>String</td>
<td>Last name of user</td>
</tr>
<tr>
<td>phone</td>
<td>String</td>
<td>Phone of user</td>
</tr>
<tr>
<td>address</td>
<td>String</td>
<td>Address of user</td>
</tr>
<tr>
<td>zipcode</td>
<td>String</td>
<td>Zipcode of user - 5 chars max</td>
</tr>
<tr>
<td>city</td>
<td>String</td>
<td>City of user</td>
</tr>
<tr>
<td>type</td>
<td>String</td>
<td>User type in: WHOLESALER - SUPERMARKET - CASHIER - TAGMANAGER - STOCKMANAGER - SUPERADMIN</td>
</tr>
</tbody>
</table>
<h1 id="errors">Errors</h1>
<aside class="notice">
This error section is stored in a separate file in <code>includes/errors.md</code>. Slate allows you to optionally separate out your docs into many files...just save them to the <code>includes</code> folder and add them to the top of your <code>index.md</code>'s frontmatter. Files are included in the order listed.
</aside>
<p>The Kittn API uses the following error codes:</p>
<table>
<thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>400</td>
<td>Bad Request – Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized – Your API key is wrong.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden – The kitten requested is hidden for administrators only.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found – The specified kitten could not be found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed – You tried to access a kitten with an invalid method.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable – You requested a format that isn’t json.</td>
</tr>
<tr>
<td>410</td>
<td>Gone – The kitten requested has been removed from our servers.</td>
</tr>
<tr>
<td>418</td>
<td>I’m a teapot.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests – You’re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error – We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable – We’re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody>
</table>

      </div>
      <div class="dark-box">
        
          <div class="lang-selector">
            
              
                <a href="#" data-language-name="javascript">javascript</a>
              
            
          </div>
        
      </div>
    </div>
  </body>
</html>
